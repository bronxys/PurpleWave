module.exports = {
nomes: ["play", "m√∫sica"],
desc: ["Pesquisa v√≠deos no YouTube e envia o √°udio."],
uso: ["<nome do v√≠deo ou artista>"],

run: async () => {
aumentartotalcmds();
aumentarcmdsgeral();

if (!q) {
return enviar(resposta.textoparametro);
}

try {

const pesquisaURL = `${urlapi}/api/pesquisa/youtube?apikey=${apikey}&query=${encodeURIComponent(q)}`;
const headersPadrao = {
Accept: "application/json",
"User-Agent":
"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0 Safari/537.36",
};

const response1 = await axios.get(pesquisaURL, { headers: headersPadrao });
const data1 = response1.data;

if (data1?.error === "Limite di√°rio de requisi√ß√µes excedido") {
const horaReset = data1.message?.match(/\d{2}:\d{2}:\d{2}/)?.[0] || "amanh√£";
return enviar(`‚ö† *Limite di√°rio da API excedido!*
√â necess√°rio atualizar o plano ou esperar at√© *${horaReset}* ‚è≥`);
}

if (
!data1 ||
!data1.resultado ||
!Array.isArray(data1.resultado.texto) ||
data1.resultado.texto.length === 0
) {
return enviar("‚ö† Nenhum v√≠deo encontrado no YouTube. Tente outro termo!");
}

const video = data1.resultado.texto[0];

const downloadURL = `${urlapi}/api/downloads/youtubemp3?apikey=${apikey}&query=${video.url}`;
const response2 = await axios.get(downloadURL, {
  headers: {
    ...headersPadrao,
    Referer: "https://hobsidian.shop/",
    Origin: "https://hobsidian.shop",
  },
});

const data2 = response2.data;
const audio = data2?.dlink; // <-- aqui
console.log(audio);
const textoresultado = `
*üé¨ T√≠tulo:* ${video.title || "n√£o encontrado"}
*üì∫ Canal:* ${video.author?.name || "n√£o encontrado"}
*üîó Link:* ${video.url || "n√£o encontrado"}
*üïí Dura√ß√£o:* ${video.timestamp || "n√£o encontrado"}
*üëÄ Views:* ${video.views?.toLocaleString() || "n√£o encontrado"}
*üìÖ Publicado:* ${video.ago || "n√£o encontrado"}
*üìù Descri√ß√£o:* ${
video.description
? video.description.substring(0, 200) + "..."
: "n√£o encontrado"
}
`.trim();

await bot.sendMessage(
from,
{
image: { url: video.thumbnail || fotomenu },
caption: textoresultado,
},
{ quoted: info }
);

if (audio) {
await bot.sendMessage(
from,
{ audio: { url: audio }, mimetype: "audio/mpeg" },
{ quoted: info }
);
} else {
enviar("‚ö† N√£o consegui obter o √°udio desse v√≠deo.");
}

} catch (erro) {
console.error("‚ùå Erro ao processar pesquisa do YouTube:", erro);
enviar(resposta.erro);
}
},
};